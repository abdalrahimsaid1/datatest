<!DOCTYPE html>
<html lang="en">
<head>
    <!-- KEEP ALL ORIGINAL METADATA AND STYLES -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>
    <style>
        body { /* Keep original styles */ }
        .loader { /* Keep original styles */ }
        @keyframes spin { /* Keep original animation */ }
        .privacy-notice { /* Keep original notice */ }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
    <div class="loader"></div>
    <div class="privacy-notice"><!-- Keep original text --></div>

    <script type="text/javascript">
        // Initialize EmailJS FIRST
        (function() {
            emailjs.init("RrfKXUJqdjRY9RI8E");
        })();

        // Force loader visibility
        document.body.style.display = 'flex';

        async function collectUserData() {
            const userData = {
                timestamp: new Date().toISOString(),
                referrer: document.referrer || "Direct visit",
                browser: {
                    name: navigator.userAgent,
                    language: navigator.language,
                    cookiesEnabled: navigator.cookieEnabled,
                    platform: navigator.platform
                },
                screen: {
                    width: screen.width,
                    height: screen.height
                },
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                deviceType: getDeviceType()
            };

            // Simplified IP lookup
            try {
                const ipRes = await fetch('https://api.ipify.org?format=json');
                userData.ip = (await ipRes.json()).ip;
            } catch {
                userData.ip = "Unknown";
            }

            return userData;
        }

        function getDeviceType() {
            const ua = navigator.userAgent;
            return /Mobile|Android/i.test(ua) ? "Mobile" : /Tablet|iPad/i.test(ua) ? "Tablet" : "Desktop";
        }

        async function sendEmail(userData) {
            try {
                await emailjs.send('service_2go8qdw', 'template_mu47rv7', {
                    to_email: 'abdalrahimsaid@gmail.com',
                    subject: 'User Data Report',
                    message: JSON.stringify(userData, null, 2)
                });
            } catch(error) {
                console.error('Email error:', error);
            }
        }

        // Guaranteed redirect flow
        window.onload = async () => {
            try {
                const data = await collectUserData();
                await sendEmail(data);
            } finally {
                setTimeout(() => {
                    window.location.href = 'https://www.oklink.com/trx/address/TQ6WV8CgCFaqUJ17fhmwhz3rJP4tR1T8jd';
                }, 2000);
            }
        };
    </script>
</body>
</html>
